C51 COMPILER V9.57.0.0   MAIN                                                              04/13/2019 21:25:40 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include<reg52.h>
   2          #include<intrins.h>
   3          #include "delay.h"
   4          #include "lcd1602.h"
   5          #include "steper.h"
   6          #include "keypress.h"
   7          
   8          uchar dishu_sheding = 0;//ËÆæÂÆöÊª¥Êï∞
   9          uchar dishu_shiji = 0;//ÂÆûÈôÖÊª¥Êï∞
  10          uchar diandi_number = 0;//Êª¥Êï∞Êï∞ÂÄº
  11          uchar Number = 0;//Êó∂Èó¥ËÆ°Êï∞
  12          uchar PuZh[4] = "";//Â≠òÂÇ®ÂèëÈÄÅÊï∞ÊçÆ
  13          uchar level = 0;//ÂΩìÂâçÊ≠•ËøõÁîµÊú∫ÁöÑ‰ΩçÁΩÆ
  14          
  15          sbit buzzer = P2^0;//ËúÇÈ∏£Âô®
  16          /*******************************************************************************
  17          * ÂáΩ Êï∞ Âêç       : Timer_Init()
  18          * ÂáΩÊï∞ÂäüËÉΩ       : ËÆæÁΩÆÂÆöÊó∂
  19          * Ëæì    ÂÖ•       : Êó†
  20          * Ëæì    Âá∫       : Êó†
  21          *******************************************************************************/
  22          void Timer_Init()
  23          {
  24   1        TMOD = 0x11;//ÂÆöÊó∂Âô®0ÂÆöÊó∂Âô®1‰∏∫Â∑•‰ΩúÊñπÂºè1
  25   1        /*  Ë£ÖËΩΩÂàùÂÄº  */
  26   1        TH0 = (65536-50000)/256;
  27   1        TL0 = (65536-50000)%256;
  28   1        
  29   1        EA = 1;//ÂºÄÊÄª‰∏≠Êñ≠
  30   1        /*  ÂºÄÂêØÂÆöÊó∂Âô®‰∏≠Êñ≠  */
  31   1        ET0 = 1;//ÂÆöÊó∂Âô®0
  32   1        /*  ÂêØÂä®ÂÆöÊó∂Âô®  */
  33   1        TR0 = 1;//ÂÆöÊó∂Âô®0
  34   1        /*  Â§ñÈÉ®‰∏≠Êñ≠  */
  35   1        EX0 = 1;
  36   1        EX1 = 1;
  37   1        IT0 = 1;
  38   1        IT1 = 1;
  39   1      }
  40          
  41          /*******************************************************************************
  42          * ÂáΩ Êï∞ Âêç       : UsartConfiguration()
  43          * ÂáΩÊï∞ÂäüËÉΩ       : ËÆæÁΩÆ‰∏≤Âè£
  44          * Ëæì    ÂÖ•       : Êó†
  45          * Ëæì    Âá∫       : Êó†
  46          *******************************************************************************/
  47          
  48          void UsartConfiguration()
  49          { 
  50   1        SCON=0X50;      //ËÆæÁΩÆ‰∏∫Â∑•‰ΩúÊñπÂºè1,8‰ΩçÊï∞ÊçÆÔºåÂèØÂèòÊ≥¢ÁâπÁéá
  51   1        TMOD=0X20;      //ËÆæÁΩÆËÆ°Êï∞Âô®Â∑•‰ΩúÊñπÂºè2
  52   1        PCON=0X00;      //Ê≥¢ÁâπÁéá‰∏çÂä†ÂÄç
  53   1        TH1=0XFd;       //ËÆ°Êï∞Âô®ÂàùÂßãÂÄºËÆæÁΩÆÔºå9600@11.0592MHz
  54   1        TL1=0XFd;
C51 COMPILER V9.57.0.0   MAIN                                                              04/13/2019 21:25:40 PAGE 2   

  55   1        TR1=1;          //ÊâìÂºÄËÆ°Êï∞Âô®
  56   1        ES = 1;         //ÂºÄ‰∏≤Âè£‰∏≠Êñ≠
  57   1        EA = 1;         //ÂºÄÊÄª‰∏≠Êñ≠
  58   1      }
  59          
  60          
  61          /*------------------------------------------------
  62           ‰∏≠Êñ≠0ÂáΩÊï∞ÔºåÊ£ÄÊµãÊª¥ÁÆ°ÈáåÈù¢‰∏ãËêΩÁÇπÊª¥ÁöÑÊï∞Èáè
  63          ------------------------------------------------*/
  64          void Interrupt0() interrupt 0
  65          {
  66   1        diandi_number++;
  67   1      }
  68          /*------------------------------------------------
  69          ÂÆöÊó∂ËÆ°Êï∞0ÔºåËÆæÂÆö‰∏∫10sÔºåÊ£ÄÊµãÁÇπÊª¥ÈÄüÂ∫¶ÔºåÊó∂Èó¥Ë∂äÈïøÔºåÁ≤æÂ∫¶Ë∂äÈ´ò
  70          ------------------------------------------------*/
  71          void T0_Time() interrupt 1 
  72          {
  73   1        /*  ÈáçË£ÖÂàùÂÄº  */
  74   1        TH0 = (65536-50000)/256;
  75   1        TL0 = (65536-50000)%256;
  76   1        Number++;
  77   1        if(Number==20*10)
  78   1        {
  79   2          Number = 0;
  80   2          dishu_shiji = diandi_number*6;
  81   2          if((dishu_shiji-dishu_sheding)>6)//Ëá™Âä®Ê†°Ê≠£ÊµÅÈÄüÁ®ãÂ∫è
  82   2          {
  83   3            
  84   3            if(level<=13)
  85   3              {
  86   4                level++;
  87   4                Move(1,10);
  88   4              }
  89   3          }
  90   2          else if((dishu_shiji-dishu_sheding)<-6)
  91   2          {
  92   3            
  93   3            if(level>=0)
  94   3              {
  95   4                level--;
  96   4                Move(0,10);
  97   4              }
  98   3            
  99   3          }
 100   2          else;
 101   2          
 102   2          diandi_number = 0;
 103   2        }
 104   1      }
 105          /*------------------------------------------------
 106           ‰∏≠Êñ≠1ÂáΩÊï∞ÔºåÊ£ÄÊµãÁÇπÊª¥Ë¢ãÊòØÂê¶ÊúâÊ∂≤‰ΩìÔºåÂΩìÂèëÁîü‰∏≠Êñ≠ÔºåËúÇÈ∏£Âô®Êä•Ë≠¶ÔºåÂπ∂‰∏îÂÖ≥Èó≠ËæìÊ∂≤ÁÆ
             -°
 107          ------------------------------------------------*/
 108          void Interrupt1() interrupt 2
 109          {
 110   1        uchar i=0;
 111   1        for(;i<13-level;i++)
 112   1        {
 113   2          Move(1,10);
 114   2        }
 115   1        dishu_sheding=0;
C51 COMPILER V9.57.0.0   MAIN                                                              04/13/2019 21:25:40 PAGE 3   

 116   1        buzzer = 0;
 117   1      }
 118          
 119          /********************************************************************
 120          * ÂêçÁß∞ : Com_Int()
 121          * ÂäüËÉΩ : ‰∏≤Âè£‰∏≠Êñ≠Â≠êÂáΩÊï∞
 122          * ËæìÂÖ• : Êó† * ËæìÂá∫ : Êó†
 123          ***********************************************************************/
 124          void Com_Int(void) interrupt 4
 125          {
 126   1        uchar i;
 127   1        uchar receive_data;
 128   1        
 129   1        EA = 0;
 130   1        
 131   1        if(RI == 1) //ÂΩìÁ°¨‰ª∂Êé•Êî∂Âà∞‰∏Ä‰∏™Êï∞ÊçÆÊó∂ÔºåRI‰ºöÁΩÆ‰Ωç
 132   1        {     
 133   2          RI = 0;
 134   2          receive_data = SBUF;//Êé•Êî∂Âà∞ÁöÑÊï∞ÊçÆ
 135   2            
 136   2          if(receive_data == '1')  
 137   2          {
 138   3            PuZh[0]='0'+dishu_shiji/100;
 139   3            PuZh[1]='0'+dishu_shiji%100/10;
 140   3            PuZh[2]='0'+dishu_shiji%10;
 141   3            PuZh[3]='\0';
 142   3            for(i=0; i<4; i++)
 143   3            {
 144   4                SBUF = PuZh[i];   //Â∞ÜË¶ÅÂèëÈÄÅÁöÑÊï∞ÊçÆÊîæÂÖ•Âà∞ÂèëÈÄÅÂØÑÂ≠òÂô®
 145   4                while(!TI);       //Á≠âÂæÖÂèëÈÄÅÊï∞ÊçÆÂÆåÊàê
 146   4                TI=0;             //Ê∏ÖÈô§ÂèëÈÄÅÂÆåÊàêÊ†áÂøó‰Ωç
 147   4                DelayMs(1);
 148   4                //LED =0;
 149   4            }
 150   3          }
 151   2          else if(receive_data == '2')//ÂÖ≥Èó≠ËúÇÈ∏£Âô®
 152   2          {
 153   3              buzzer=1; 
 154   3          }
 155   2          else if(receive_data == '3')//Ê≠£ÂêëË∞ÉÊï¥Ê≠•ËøõÁîµÊú∫
 156   2          {
 157   3              if(level<=13)
 158   3              {
 159   4                level++;
 160   4                Move(1,10);
 161   4              } 
 162   3          }
 163   2            else if(receive_data == '4')//ÂèçÂêëË∞ÉÊï¥Ê≠•ËøõÁîµÊú∫
 164   2          {
 165   3                if(level>=0)
 166   3              {
 167   4                level--;
 168   4                Move(0,10);
 169   4              }
 170   3          }
 171   2            else if(receive_data == '5')//ÂÖ≥Èó≠ÁÇπÊª¥
 172   2          {
 173   3                uchar i=0;
 174   3                for(;i<13-level;i++)
 175   3                {
 176   4                  Move(1,10);
 177   4                }
C51 COMPILER V9.57.0.0   MAIN                                                              04/13/2019 21:25:40 PAGE 4   

 178   3                dishu_sheding=0;
 179   3            }
 180   2          else;
 181   2          
 182   2        }
 183   1          
 184   1        
 185   1          EA = 1;
 186   1      }
 187          
 188          
 189          void main()
 190          {
 191   1        
 192   1        uchar keyvalue;//ÈîÆÂÄº
 193   1        uchar k;//ËÆæÂÆöÊª¥Êï∞ÊòæÁ§∫ÁöÑ‰ΩçÁΩÆ
 194   1        uchar value[3]={0,0,0};//‰øùÂ≠òËæìÂÖ•ËÆæÂÆöÊª¥Êï∞ÁöÑÂÄº,ÈªòËÆ§‰∏∫0
 195   1        uchar i;//‰∏¥Êó∂ÂèòÈáè
 196   1        
 197   1        buzzer=1;//ÂàùÂßãÂåñËúÇÈ∏£Âô®
 198   1        lcd1602_init();//ÂàùÂßãÂåñlcd
 199   1        Timer_Init();//ÂàùÂßãÂåñÂÆöÊó∂
 200   1        UsartConfiguration();//ÂàùÂßãÂåñ‰∏≤Âè£
 201   1          
 202   1        
 203   1        while(1)
 204   1        {   
 205   2          lcd1602_clear();//Ê∏ÖÂ±è
 206   2          lcd1602_write_string(0,0,"now:");
 207   2          lcd1602_write_string(9,0,"d/min");
 208   2          lcd1602_write_string(0,1,"set:");
 209   2          lcd1602_write_string(9,1,"d/min");
 210   2          lcd1602_write_char(6,0,'0'+dishu_shiji/100);
 211   2          lcd1602_write_char(7,0,'0'+dishu_shiji%100/10);
 212   2          lcd1602_write_char(8,0,'0'+dishu_shiji%10);
 213   2            
 214   2            
 215   2          if (KeyPress())
 216   2              {//ÊåâÈîÆÂ§ÑÁêÜÁ®ãÂ∫è
 217   3                  keyvalue = KeyScan();
 218   3                
 219   3                  if (keyvalue ==14)
 220   3                  {//ÊâãÂä®Ê†°ÂáÜÊ≠•ËøõÁîµÊú∫
 221   4                    DelayMs(200);//ÂéªÊäñ
 222   4                    while(1)
 223   4                    {
 224   5                      if(KeyPress())
 225   5                      {
 226   6                        keyvalue = KeyScan();
 227   6                        if(keyvalue == 11)//Ê≠£ÂêëË∞ÉÊï¥
 228   6                        {
 229   7                          Move(1,10);
 230   7                        }           
 231   6                        if(keyvalue == 12)//ÂèçÂêëË∞ÉÊï¥
 232   6                        {
 233   7                          Move(0,10);
 234   7                        }
 235   6                        if(keyvalue ==16)//ÈÄÄÂá∫
 236   6                        {
 237   7                          level = 0;
 238   7                          break;
 239   7                        }
C51 COMPILER V9.57.0.0   MAIN                                                              04/13/2019 21:25:40 PAGE 5   

 240   6                        while (KeyPress());
 241   6                      }
 242   5                    } 
 243   4                  }
 244   3                  
 245   3                  if(keyvalue ==15)
 246   3                  {//ËÆæÁΩÆÊòæÁ§∫Ê®°Âºè
 247   4                    DelayMs(200);//ÂéªÊäñ
 248   4                    while(1)
 249   4                    {
 250   5                      if(KeyPress())
 251   5                      {
 252   6                        keyvalue = KeyScan();
 253   6                        if(keyvalue ==11)//ÂêëÂ∑¶ÊªöÂä®
 254   6                        {
 255   7                            i=40;
 256   7                            while(i--)
 257   7                            {
 258   8                              DelayMs(200);
 259   8                              lcd1602_turn_right();
 260   8                            }   
 261   7                        }
 262   6                        if(keyvalue ==12)//ÂêëÂè≥ÊªöÂä®
 263   6                        {
 264   7                            i=40;
 265   7                            while(i--)
 266   7                            {
 267   8                              DelayMs(200);
 268   8                              lcd1602_turn_left();
 269   8                            }
 270   7                        }
 271   6                        if(keyvalue ==16)//Ê∏ÖÂ±èÂπ∂ÈÄÄÂá∫
 272   6                        {
 273   7                          lcd1602_clear();
 274   7                          break;
 275   7                        }
 276   6                        while (KeyPress());
 277   6                      }
 278   5                    }
 279   4                    
 280   4                  }
 281   3                          
 282   3                  
 283   3                  if(keyvalue==13)
 284   3                  {//ËÆæÂÆöÊª¥Êï∞
 285   4                    DelayMs(200);//ÂéªÊäñ
 286   4                    k=6;
 287   4                    while(1)
 288   4                    {
 289   5                      DelayMs(200);//ÂéªÊäñ
 290   5                      if(KeyPress())
 291   5                      {
 292   6                        keyvalue = KeyScan();
 293   6                        if(keyvalue==0||keyvalue==1||keyvalue==2||keyvalue==3||keyvalue==4||keyvalue==5||keyvalue==6||key
             -value==7||keyvalue==8||keyvalue==9)
 294   6                        {
 295   7                          if(k==6)
 296   7                          {
 297   8                            value[0]=keyvalue;
 298   8                          }
 299   7                          else if(k==7)
 300   7                          {
C51 COMPILER V9.57.0.0   MAIN                                                              04/13/2019 21:25:40 PAGE 6   

 301   8                            value[1]=keyvalue;
 302   8                          }
 303   7                          else if(k==8)
 304   7                          {
 305   8                            value[2]=keyvalue;
 306   8                          }
 307   7                          keyvalue = '0'+ keyvalue;           
 308   7                          lcd1602_write_char(k,1,keyvalue);
 309   7                        }
 310   6                        else if(keyvalue == 11)
 311   6                        {
 312   7                          k=k-1;
 313   7                        }
 314   6                        else if(keyvalue == 12)
 315   6                        {
 316   7                          k=k+1;
 317   7                        }
 318   6                        else if (keyvalue==16)
 319   6                        {
 320   7                          dishu_sheding = value[0]*100+value[1]*10+value[2]; 
 321   7                          break;
 322   7                        }
 323   6                        else;
 324   6                        while (KeyPress());
 325   6                      }
 326   5                    }
 327   4                  }
 328   3                  while (KeyPress());
 329   3              }else{
 330   3                lcd1602_write_char(6,1,'0'+dishu_sheding/100);
 331   3                lcd1602_write_char(7,2,'0'+dishu_sheding%100/10);
 332   3                lcd1602_write_char(8,3,'0'+dishu_sheding%10);
 333   3              }
 334   2              
 335   2          DelayMs(200);
 336   2        }
 337   1      } 
 338          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1467    ----
   CONSTANT SIZE    =     19    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
